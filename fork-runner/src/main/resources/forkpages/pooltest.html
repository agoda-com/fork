<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fork Execution</title>
    <link href="http://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold"
          rel="stylesheet">
    <link href="../../static/bootstrap.min.css" rel="stylesheet">
    <link href="../../static/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="../../static/spoon.css" rel="stylesheet">
    <link href="../../static/fork.css" rel="stylesheet">
    <script src="../../static/jquery.min.js"></script>
    <script src="../../static/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
    <div class="hero-unit {{status}}">
        <h1>{{prettyMethodName}}</h1>
        <p>{{prettyClassName}} - Took {{timeTaken}}s on {{deviceSerial}} ({{deviceModelDespaced}})</p>
        <p><a href="../{{plainPoolName}}.html">Other tests for this pool</a> - <a
                href="../../../logcat/{{plainPoolName}}/{{deviceSafeSerial}}/{{plainClassName}}%23{{plainMethodName}}.log">Log
            file</a></p>
    </div>
    {{#diagnosticVideo}}
    <video class="diagnostic {{status}}" width="35%" height="35%" controls
           src="../../../screenrecord/{{plainPoolName}}/{{deviceSafeSerial}}/{{plainClassName}}%23{{plainMethodName}}.mp4"
           type="video/mp4">
        Is video supported in this browser?
    </video>
    {{/diagnosticVideo}}
    {{#diagnosticScreenshots}}
    <img class="diagnostic {{status}}" width="35%" height="35%"
         src="../../../animation/{{plainPoolName}}/{{deviceSafeSerial}}/{{plainClassName}}%23{{plainMethodName}}.gif"/>
    {{/diagnosticScreenshots}}
    <pre class="test {{status}}">{{#trace}}
{{.}}
{{/trace}}</pre>
    <form>
        <input type="text" id="filter" class="regex" placeholder="Search for regular expression"/>
        <input type="button" value="Hide" onclick="filterTable('none')">
        <input type="button" value="Show" onclick="filterTable('')">
    </form>
    <div>
        <table class="table logcat">
            <tr>
                <th>Process</th>
                <th>Tag</th>
                <th>Level</th>
                <th>Time</th>
                <th class="message">Message</th>
            </tr>
        </table>
    </div>
</div>

<script type="text/javascript">
        var url = "../../../logcat_json/{{plainPoolName}}/{{deviceSafeSerial}}/{{plainClassName}}%23{{plainMethodName}}.json";

        var json = readTextFile(url,function (text) {
            var data = JSON.parse(text);
            render(data);
        });


        function render(json) {
            var table = document.getElementsByClassName("table logcat")[0];

            for (var i = 0; i < json.length; i++) {
                var process = json[i].mHeader.mPid;
                var tag = json[i].mHeader.mTag;
                var level = json[i].mHeader.mLogLevel;
                var timestamp = json[i].mHeader.mTimestamp;
                var time = timestamp.mMonth + "-" + timestamp.mDay + " " + timestamp.mHour + ":" + timestamp.mMinute + ":" + timestamp.mSecond + "." + timestamp.mMilli;
                var message = json[i].mMessage;

                var cell = table.insertRow(1 + i);
                var style = selectStyle(json[i]);
                cell.innerHTML = "<tr><td>" + process + "</td><td>" + tag + "</td><td>" + level + "</td><td>" + time + "</td><td class=\"message\">" + message + "</td></tr>"
                cell.className = style

            }
        }

        function readTextFile(file, callback) {
            var rawFile = new XMLHttpRequest();
            rawFile.overrideMimeType("application/json");
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function() {
                if (rawFile.readyState === 4 && rawFile.status == "200") {
                    callback(rawFile.responseText);
                }
            };
            rawFile.send(null);
        }
        function selectStyle(json) {
            switch (json.mHeader.mLogLevel) {
                case "WARN":
                    return "line warn";
                case "DEBUG": {
                    return "line debug";
                }
                case "ERROR": {
                    return "line error";
                }
                case "VERBOSE": {
                    return "line verbose";
                }
                case "INFO": {
                    return "line info";
                }
            }
        }

</script>

<script type="text/javascript">
            $('.test a').popover({
                placement: 'top',
                trigger: 'hover'
            });


</script>
<script language="javascript">
                function filterTable(mode) {
                   rows=document.getElementsByClassName('logcat')[0].rows;
                   regex=document.getElementById('filter').value;
                   for (i=1; i<rows.length; ++i) {
                     if (rows[i].textContent.match(regex)) {
                       rows[i].style.display=mode;
                     }
                   }
                }


</script>
</body>
</html>
